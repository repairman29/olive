# Olive — Deployment Guide

**For humans and AI agents (e.g. Cursor bots):** Use this doc when committing, pushing, or deploying Olive so production (shopolive.xyz) stays correct.

---

## Quick reference

| What | How |
|------|-----|
| **Production app** | Next.js on Vercel; domain **shopolive.xyz** |
| **Vercel project** | **cartpilot** (project name in Vercel) |
| **Deploy from Git** | Push to `main` → Vercel auto-deploys if the repo is connected |
| **Deploy from CLI** | From repo root: `npx vercel --prod` (optional `--yes` to skip prompts) |
| **After env changes** | Set vars in Vercel Dashboard (Production), then **Redeploy** (Deployments → ⋯ → Redeploy; uncheck "Use existing Build Cache") so the live deployment gets the new env |

---

## Commit & push (for bots)

1. **Do not commit:** `.auth/`, `playwright-report/`, `.env*` (except `.env.test.example`), `node_modules`, `.next`, `.vercel`.
2. **Do commit:** All source under `src/`, `public/` (including `public/icons/`, `public/olive-branch.svg`, `icon-192.png`, `icon-512.png`), `docs/`, `scripts/`, `e2e/`, config files (`package.json`, `next.config.*`, etc.). Favicon is in `src/app/favicon.ico` (generated by `npm run generate-icons`).
3. **Icon assets:** PWA icons and favicon are generated from `public/olive-logo.png` by `npm run generate-icons`. Commit the generated `public/icon-192.png`, `public/icon-512.png`, and `src/app/favicon.ico` after running that script if the logo changed.
4. **Suggested commit message pattern:** Short summary (e.g. `Iconography: bespoke icons, theme toggle, 404`); optional body with bullet list of changes.

---

## Deploy to production

- **Preferred:** Push to `main` and let Vercel build from the connected repo. Confirm in Vercel Dashboard → **cartpilot** → Deployments that the latest production deployment succeeded.
- **Alternative:** From the repo root, run `npx vercel --prod`. If the production domain (shopolive.xyz) is bound to "latest from Git", a CLI deploy may create a new deployment that is not automatically assigned to the domain; in that case use **Vercel Dashboard → Deployments → ⋯ on the new deployment → Promote to Production**, or redeploy from the latest Production deployment instead.
- **After changing env vars:** Env is applied only to **new** builds. Use Vercel Dashboard → **cartpilot** → Deployments → ⋯ on latest **Production** → **Redeploy** (uncheck "Use existing Build Cache") so shopolive.xyz runs a build that has the updated env.

---

## Post-deploy checks

- **App:** Open https://shopolive.xyz and confirm the UI loads (nav, theme toggle, dashboard if signed in).
- **Kroger env (if add-to-cart matters):** Open https://shopolive.xyz/api/kroger/env-check and confirm `tokenCheck.ok === true`. If not, fix `KROGER_CLIENT_ID` / `KROGER_CLIENT_SECRET` in Vercel (Production) and redeploy.
- **PWA / icons:** If favicon or app icons look wrong, ensure `public/icon-192.png`, `public/icon-512.png`, and `src/app/favicon.ico` are committed and that the latest deployment includes them. Users may need a hard refresh or to clear site data for shopolive.xyz to see new icons.

---

## Related docs

- **Env and 503s:** [ADD-TO-CART-503-REVIEW.md](./ADD-TO-CART-503-REVIEW.md)
- **General ops:** [OLIVE_PRODUCT_MASTER_MANUAL.md](./OLIVE_PRODUCT_MASTER_MANUAL.md) (§ Operations & Verification)
- **Troubleshooting:** [TROUBLESHOOTING.md](./TROUBLESHOOTING.md)
